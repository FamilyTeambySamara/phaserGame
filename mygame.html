<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    <div id="game"></div>

    <script src="phaser.min.js"></script>

    <script type="text/javascript">
        var game = new Phaser.Game(480, 640, Phaser.AUTO, '', { preload: preload, create: create, update: update });

        var playerBet;
        var computerBet;
        var ball;

        var scoreTable;

        var ballReleased = false;

        var computerBetSpeed = 150;
        var ballSpeed = 300;
        var score = 0;




        function preload() {
            game.load.image('bet', 'assets/bet_3.png');
            game.load.image('ball', 'assets/ball.png');
            game.load.image('background', 'assets/starfield.jpg');
        }

        function create() {
          
          game.physics.startSystem(Phaser.Physics.ARCADE);

          game.add.tileSprite(0, 0, 480, 640, 'background');

          scoreTable =  game.add.text(16, 16, 'score: 0', { fontSize: '32px', fill: 'red' });

          computerBet = createBet(game.world.centerX, 400);
          playerBet = createBet(game.world.centerX, 30);




          ball = game.add.sprite(game.world.centerX, game.world.centerY, 'ball');
           ball.anchor.setTo(0.5, 0.5);
           game.physics.arcade.enable(ball);
           ball.body.collideWorldBounds = true;
           ball.body.bounce.setTo(1, 1);


           game.input.onDown.add(releaseBall, this);
        }

        function createBet(x, y) {
            var bet = game.add.sprite(x, y, 'bet');
            bet.anchor.setTo(0.5, 0.5);
            game.physics.arcade.enable(bet);
            bet.body.collideWorldBounds = true;
            bet.body.bounce.setTo(1, 1);
            bet.body.immovable = true;

            return bet;
        }

        function releaseBall() {
      if (!ballReleased) {
          ball.body.velocity.x = ballSpeed;
          ball.body.velocity.y = -ballSpeed;
          ballReleased = true;
      }
  }

        function ballHitsBet (_ball, _bet) {
             var diff = 0;

             if (_ball.x < _bet.x) {
                 //  Шарик находится с левой стороны ракетки
                 diff = _bet.x - _ball.x;
                 _ball.body.velocity.x = (-10 * diff);
             }
             else if (_ball.x > _bet.x) {
                 //  Шарик находится с правой стороны ракетки
                 diff = _ball.x -_bet.x;
                 _ball.body.velocity.x = (10 * diff);
             }
             else {
                 //  Шарик попал в центр ракетки, добавляем немножко трагической случайности его движению
                 _ball.body.velocity.x = 2 + Math.random() * 8;
             }
         }

         function checkGoal() {
       if (ball.y < 15) {

         score = score + 10;
          scoreTable.text = 'player: ' + score;
           setBall();
       } else if (ball.y > 625) {
         score = score - 10;
         scoreTable.text = 'player: ' + score;
           setBall();
       }
   }

   function setBall() {
       if (ballReleased) {
           ball.x = game.world.centerX;
           ball.y = game.world.centerY;
           ball.body.velocity.x = 0;
           ball.body.velocity.y = 0;
           ballReleased = false;
       }

   }


        function update () {
          //Управляем ракеткой игрока
       playerBet.x = game.input.x;

       var playerBetHalfWidth = playerBet.width / 2;

       if (playerBet.x < playerBetHalfWidth) {
           playerBet.x = playerBetHalfWidth;
       }
       else if (playerBet.x > game.width - playerBetHalfWidth) {
           playerBet.x = game.width - playerBetHalfWidth;
       }

       //Управляем ракеткой компьютерного соперника
       if(computerBet.x - ball.x < -15) {
           computerBet.body.velocity.x = computerBetSpeed;
       }
       else if(computerBet.x - ball.x > 15) {
           computerBet.body.velocity.x = -computerBetSpeed;
       }
       else {
           computerBet.body.velocity.x = 0;
       }

       // game.physics.arcade.collide(ball, playerBet);
       // game.physics.arcade.collide(ball, computerBet);



       game.physics.arcade.collide(ball, playerBet, ballHitsBet, null, this);
       game.physics.arcade.collide(ball, computerBet, ballHitsBet, null, this);

       checkGoal();
   }





    </script>

</body>
</html>
